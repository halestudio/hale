<?xml version="1.0" encoding="UTF-8"?>
<?eclipse version="3.4"?>
<plugin>
   <extension-point id="eu.esdihumboldt.hale.ui.io.config" name="I/O configuration wizard pages" schema="schema/eu.esdihumboldt.hale.ui.io.config.exsd"/>
   <extension-point id="eu.esdihumboldt.hale.MappingExport" name="Mapping Export Providers" schema="schema/eu.esdihumboldt.hale.MappingExport.exsd"/>
   <extension-point id="eu.esdihumboldt.hale.ui.function" name="Function wizards" schema="schema/eu.esdihumboldt.hale.ui.function.exsd"/>
   <extension-point id="eu.esdihumboldt.hale.ui.io.action" name="UI extensions for I/O actions" schema="schema/eu.esdihumboldt.hale.ui.io.action.exsd"/>
   <extension-point id="eu.esdihumboldt.hale.ui.io.source" name="Import sources" schema="schema/eu.esdihumboldt.hale.ui.io.source.exsd"/>
   <extension
         point="org.eclipse.ui.commands">
      <command
            id="eu.esdihumboldt.hale.ui.project.open"
            name="Open project">
      </command>
      <command
            id="eu.esdihumboldt.hale.ui.project.export"
            name="Save project as">
      </command>
      <command
            id="eu.esdihumboldt.hale.ui.project.new"
            name="New project">
      </command>
      <command
            id="eu.esdihumboldt.hale.ui.project.save"
            name="Save project">
      </command>
      <command
            id="eu.esdihumboldt.hale.ui.entity.addcontext"
            name="Add instance context">
      </command>
      <command
            id="eu.esdihumboldt.hale.ui.entity.removecontext"
            name="Remove instance context">
      </command>
   </extension>
   <extension
         point="org.eclipse.ui.handlers">
      <handler
            class="eu.esdihumboldt.hale.ui.service.project.handler.SaveProjectHandler"
            commandId="eu.esdihumboldt.hale.ui.project.save">
      </handler>
      <handler
            class="eu.esdihumboldt.hale.ui.service.project.handler.NewProjectHandler"
            commandId="eu.esdihumboldt.hale.ui.project.new">
      </handler>
      <handler
            class="eu.esdihumboldt.hale.ui.service.project.handler.SaveAsProjectHandler"
            commandId="eu.esdihumboldt.hale.ui.project.export">
      </handler>
      <handler
            class="eu.esdihumboldt.hale.ui.service.project.handler.OpenProjectHandler"
            commandId="eu.esdihumboldt.hale.ui.project.open">
      </handler>
      <handler
            class="eu.esdihumboldt.hale.ui.service.entity.internal.handler.AddContextHandler"
            commandId="eu.esdihumboldt.hale.ui.entity.addcontext">
         <activeWhen>
            <reference
                  definitionId="eu.esdihumboldt.hale.ui.selection.entity.allow_contextadd">
            </reference>
         </activeWhen>
      </handler>
      <handler
            class="eu.esdihumboldt.hale.ui.service.entity.internal.handler.RemoveContextHandler"
            commandId="eu.esdihumboldt.hale.ui.entity.removecontext">
         <activeWhen>
            <reference
                  definitionId="eu.esdihumboldt.hale.ui.selection.entity.allow_contextremove">
            </reference>
         </activeWhen>
      </handler>
      <handler
            class="eu.esdihumboldt.hale.ui.service.align.internal.handler.RemoveCellHandler"
            commandId="org.eclipse.ui.edit.delete">
         <activeWhen>
            <with
                  variable="selection">
               <iterate
                     operator="or">
                  <instanceof
                        value="eu.esdihumboldt.hale.common.align.model.Cell">
                  </instanceof>
               </iterate>
            </with>
         </activeWhen>
      </handler>
   </extension>
   <extension
         point="org.eclipse.ui.services">
      <sourceProvider
            provider="eu.esdihumboldt.hale.ui.service.instance.internal.InstanceServiceSource">
         <variable
               name="hale.instances.has_transformed"
               priorityLevel="workbench">
         </variable>
      </sourceProvider>
      <serviceFactory
            factoryClass="eu.esdihumboldt.hale.ui.service.internal.HaleServiceFactory">
         <service
               serviceClass="eu.esdihumboldt.hale.ui.service.report.ReportService">
         </service>
         <service
               serviceClass="eu.esdihumboldt.hale.ui.service.instance.InstanceService">
         </service>
         <service
               serviceClass="eu.esdihumboldt.hale.ui.service.align.AlignmentService">
         </service>
         <service
               serviceClass="eu.esdihumboldt.hale.ui.service.project.ProjectService">
         </service>
         <service
               serviceClass="eu.esdihumboldt.hale.ui.service.project.RecentFilesService">
         </service>
         <service
               serviceClass="eu.esdihumboldt.hale.ui.service.schema.SchemaService">
         </service>
         <service
               serviceClass="eu.esdihumboldt.hale.ui.service.entity.EntityDefinitionService">
         </service>
      </serviceFactory>
      <sourceProvider
            provider="eu.esdihumboldt.hale.ui.service.schema.internal.SchemaServiceSource">
         <variable
               name="hale.schemas.has_source"
               priorityLevel="workbench">
         </variable>
         <variable
               name="hale.schemas.has_target"
               priorityLevel="workbench">
         </variable>
      </sourceProvider>
      <sourceProvider
            provider="eu.esdihumboldt.hale.ui.service.align.internal.AlignmentServiceSource">
         <variable
               name="hale.alignment.has_cells"
               priorityLevel="workbench">
         </variable>
      </sourceProvider>
   </extension>
   <extension
         point="eu.esdihumboldt.hale.ui.io.action">
      <action-ui
            action="eu.esdihumboldt.hale.io.schema.read.source"
            id="eu.esdihumboldt.hale.io.schema.read.source.ui"
            label="Source schema..."
            priority="-10"
            projectResource="true"
            wizard="eu.esdihumboldt.hale.ui.io.schema.SchemaImportWizard">
      </action-ui>
      <action-ui
            action="eu.esdihumboldt.hale.io.schema.read.target"
            id="eu.esdihumboldt.hale.io.schema.read.target.ui"
            label="Target schema..."
            priority="-9"
            projectResource="true"
            wizard="eu.esdihumboldt.hale.ui.io.schema.SchemaImportWizard">
      </action-ui>
      <action-ui
            action="eu.esdihumboldt.hale.io.instance.read.source"
            id="eu.esdihumboldt.hale.io.instance.read.source.ui"
            label="Source data..."
            priority="-6"
            projectResource="true"
            wizard="eu.esdihumboldt.hale.ui.io.instance.InstanceImportWizard">
         <enabledWhen>
            <with
                  variable="hale.schemas.has_source">
               <equals
                     value="true">
               </equals>
            </with>
         </enabledWhen>
      </action-ui>
      <action-ui
            action="eu.esdihumboldt.hale.io.align.read"
            id="eu.esdihumboldt.hale.io.align.read.ui"
            label="Alignment..."
            priority="0"
            projectResource="false"
            wizard="eu.esdihumboldt.hale.ui.io.align.AlignmentImportWizard">
         <enabledWhen>
            <and>
               <with
                     variable="hale.schemas.has_source">
                  <equals
                        value="true">
                  </equals>
               </with>
               <with
                     variable="hale.schemas.has_target">
                  <equals
                        value="true">
                  </equals>
               </with>
            </and>
         </enabledWhen>
      </action-ui>
      <action-ui
            action="eu.esdihumboldt.hale.io.align.write"
            id="eu.esdihumboldt.hale.io.align.write.ui"
            label="Alignment..."
            priority="0"
            projectResource="false"
            wizard="eu.esdihumboldt.hale.ui.io.align.AlignmentExportWizard">
         <enabledWhen>
            <with
                  variable="hale.alignment.has_cells">
               <equals
                     value="true">
               </equals>
            </with>
         </enabledWhen>
      </action-ui>
   </extension>
   <extension
         point="eu.esdihumboldt.hale.ui.io.source">
      <source
            class="eu.esdihumboldt.hale.ui.io.source.FileSource"
            description="Load a resource from a file"
            icon="icons/file_obj.gif"
            id="eu.esdihumboldt.hale.ui.io.source.file"
            name="file"
            priority="-10">
      </source>
      <source
            class="eu.esdihumboldt.hale.ui.io.source.URLSource"
            description="Load a resource from the web"
            icon="icons/discovery.gif"
            id="eu.esdihumboldt.hale.ui.io.source.url"
            name="URL"
            priority="-5">
      </source>
   </extension>
   <extension
         point="org.eclipse.ui.views">
      <category
            id="eu.esdihumboldt.hale.ui"
            name="HALE">
      </category>
   </extension>
   <extension
         point="eu.esdihumboldt.hale.io.action">
      <advisor
            action="eu.esdihumboldt.hale.io.schema.read.source"
            class="eu.esdihumboldt.hale.ui.io.schema.SourceSchemaImportAdvisor"
            id="eu.esdihumboldt.hale.ui.io.schema.read.source">
      </advisor>
      <advisor
            action="eu.esdihumboldt.hale.io.schema.read.target"
            class="eu.esdihumboldt.hale.ui.io.schema.TargetSchemaImportAdvisor"
            id="eu.esdihumboldt.hale.ui.io.schema.read.target">
      </advisor>
      <advisor
            action="eu.esdihumboldt.hale.io.instance.read.source"
            class="eu.esdihumboldt.hale.ui.io.instance.InstanceImportAdvisor"
            id="eu.esdihumboldt.hale.ui.io.instance.read.source">
      </advisor>
      <advisor
            action="eu.esdihumboldt.hale.io.align.read"
            class="eu.esdihumboldt.hale.ui.io.align.AlignmentImportAdvisor"
            id="eu.esdihumboldt.hale.ui.io.align.read">
      </advisor>
      <advisor
            action="eu.esdihumboldt.hale.io.align.write"
            class="eu.esdihumboldt.hale.ui.io.align.AlignmentExportAdvisor"
            id="eu.esdihumboldt.hale.ui.io.align.write">
      </advisor>
   </extension>
   <extension
         point="org.eclipse.ui.menus">
      <menuContribution
            allPopups="false"
            locationURI="popup:org.eclipse.ui.popup.any?after=additions">
         <command
               commandId="eu.esdihumboldt.hale.ui.entity.addcontext"
               label="Add instance context"
               style="push">
            <visibleWhen
                  checkEnabled="true">
            </visibleWhen>
         </command>
         <command
               commandId="eu.esdihumboldt.hale.ui.entity.removecontext"
               label="Remove instance context"
               style="push">
            <visibleWhen
                  checkEnabled="false">
               <with
                     variable="selection">
                  <iterate
                        ifEmpty="false"
                        operator="and">
                     <test
                           property="eu.esdihumboldt.hale.ui.service.entity.has_named_context">
                     </test>
                  </iterate>
               </with>
            </visibleWhen>
         </command>
         <command
               commandId="org.eclipse.ui.edit.delete"
               label="Delete"
               style="push">
            <visibleWhen
                  checkEnabled="true">
            </visibleWhen>
         </command>
      </menuContribution>
      <menuContribution
            allPopups="false"
            locationURI="menu:org.eclipse.ui.main.menu?after=file">
         <menu
               id="edit"
               label="Edit"
               mnemonic="e">
            <command
                  commandId="org.eclipse.ui.edit.delete"
                  label="Delete"
                  mnemonic="d"
                  style="push">
            </command>
         </menu>
      </menuContribution>
   </extension>
   <extension
         point="org.eclipse.core.expressions.propertyTesters">
      <propertyTester
            class="eu.esdihumboldt.hale.ui.service.entity.internal.tester.InstanceContextTester"
            id="eu.esdihumboldt.hale.ui.service.entity"
            namespace="eu.esdihumboldt.hale.ui.service.entity"
            properties="allow_add,has_named_context,allow_remove"
            type="eu.esdihumboldt.hale.common.align.model.EntityDefinition">
      </propertyTester>
   </extension>
   <extension
         point="org.eclipse.core.expressions.definitions">
      <definition
            id="eu.esdihumboldt.hale.ui.selection.entity.allow_contextadd">
         <with
               variable="selection">
            <and>
               <count
                     value="1">
               </count>
               <iterate
                     ifEmpty="false"
                     operator="and">
                  <test
                        property="eu.esdihumboldt.hale.ui.service.entity.allow_add">
                  </test>
               </iterate>
            </and>
         </with>
      </definition>
      <definition
            id="eu.esdihumboldt.hale.ui.selection.entity.allow_contextremove">
         <with
               variable="selection">
            <and>
               <iterate
                     ifEmpty="false"
                     operator="and">
                  <test
                        property="eu.esdihumboldt.hale.ui.service.entity.allow_remove">
                  </test>
               </iterate>
            </and>
         </with>
      </definition>
   </extension>

</plugin>
